<%= semantic_form_for [:admin, @item], :html => { :enctype => "multipart/form-data" }  do |f| %>

  <%= f.inputs :name => "Required Main Information" do %>
    <%= f.input :category,
                :as => :select,
                :label_method => 'title',
                :value_method => :id,
                :label => "Category",
                :required => true,
                :hint => "It's required to pick a category"
    %>
    <%= f.input :language,
                :as => :select,
                :label_method => 'description',
                :value_method => :id,
                :label => "Language",
                :required => true,
                :hint => "Select a language for this article"
    %>
    <%= f.input :title,
                :label => "Headline",
                :required => true,
                :hint => "Required, ideal 60 characters. Max 100." %>
                
    <%= f.input :abstract,
                :hint => "Required, ideal 80 characters. Max 120.",
                :required => true,
                :input_html => { :rows => 2 }
    %>
    
    <%= f.input :body,
                :label => "Main Content",
                :required => true,
                :input_html => { :rows => 60, :cols => 120},
                :hint => "If you want a new paragraph, simply hit 'RETURN'. If you donâ€™t want a new paragraph and just want a line break, hit 'SHIFT RETURN'. - If you are copying and pasting from a website, it is recommended to paste first to Notepad.exe/TextEdit.app then copy again to paste here."
    %>
    <%= f.input :keywords,
                :label => "Keywords",
                :required => false,
                :hint => "Keywords related to the article, such as names, events, and any keyword that are not available in Tags sections. i.e. Obama, ACTA, SOPA, PIPA, Monsanto, GMO, Pepsi, gold, bank, money, cocaine, etc... It will greatly improve discovery of related items. You may also use special keywords to relate other items. It's invisble to the users."
    %>
  <% end %>
  
  <%= f.inputs :name => "Youtube Video" do %>
    <%= f.input :youtube_id, :label => "Youtube Video ID", 
          :hint => "Needed if one of options below are used." %>
    <%= f.input :youtube_vid, :label => "Youtube Video",
          :hint => "Automatically embed the youtube video at the bottom of the article." 
    %>
    <br />
    <%= f.input :youtube_img, :label => "Youtube Image", :hint => "Automatically set main image from the youtube screenshot" %>
    <br />
  <% end %>
  
  
  <%= f.inputs :name => "Tags" do %>
    <div class="medium_box">
      <%= f.input :general_tags, :as => :check_boxes, :label => "General",
          :collection => GeneralTag.find(:all, :order => "title ASC")
      %>
    </div>
    <div class="medium_box">
      <%= f.input :region_tags, :as => :check_boxes, :label => "Regional",
          :collection => RegionTag.find(:all, :order => "title ASC") 
      %>
    </div>
    <div class="medium_box">
      <%= f.input :country_tags, :as => :check_boxes, :label => "Countries",
          :collection => CountryTag.find(:all, :order => "title ASC") 
      %>
    </div>
  <% end %>
  
  <%= f.inputs :name => "Optional" do %>
    <%= f.input :author_name, :hint => "If blank, your 'Name' will be used" %>
    <%= f.input :author_email %>
    <%= f.input :source_url, :hint => "If you wrote the article, leave empty" %>
  <% end %>
  
  <%= f.inputs :name => "Status Codes" do %>
    <%= f.input :draft, :hint => "Keep as draft if you haven't finished editing." %><br />
    <%= f.input :featured, :hint => "Will be featured on front page" %><br />
    <%= f.input :allow_comments, :hint => "Allow users to comment using IntenseDebate" %><br />
    <%#= f.input :protected_record, :hint => "Locked from editing, use with caution." %>
    
    <% if f.object.twitter_shares.empty? %>
      <%= f.input :share_twitter, :as => "boolean", 
          :hint => "Auto post to twitter upon publication? Only set it if item is ready and not Draft. It can only be posted once." %>
    <% else %>
      <li class="boolean input optional">
        <label><b>Already posted to twitter</b></label>
      </li>
    <% end %>
    <%#= f.input :share_facebook, :hint => "Auto share on facebook upon publication?" %>
    <%#= f.input :share_reddit, :hint => "Auto post to Reddit upon publication?" %>
    <br />
  <% end %>
  
  <%= f.inputs :name => "Dates and Status" do %>
    <%#= f.input :published_at, 
          :label => "Publication Date",  
          :hint => "When article will go live (default: 10 minutes from now)", 
          :time => true 
    %>
    <%= f.input :published_at, 
          :value => f.object.published_at.localtime,
          :as => "string",
          :label => "Publication Date",
          :hint => "When to go live. Timezone used for picking date: '#{Time.zone}' (from your Profile). It will be converted to UTC after saving."
    %>
    <%#= f.input :expires_on, :label => "Expire Date", :hint => "Expiration Date of article (default: 10 years)", :time => true %>
    <%= f.input :expires_on,
        :as => "string",
        :label => "Expire Date",
        :value => f.object.expires_on.localtime,
        :hint => "Expiration Date of article (default: 10 years). It will be converted to UTC after saving."
    %>
  <% end %>

  <% f.object.attachments.build %>
  <%= f.inputs :name => "Main Image", :multipart => true do %>
    <div class="item_attachments">
      <%= f.semantic_fields_for :attachments do |attachment| %>
        <% if attachment.object.new_record? %>
          <%= attachment.input :title, :as => "string", :label => "Image Caption" %>
          <%= attachment.input :image, :as => "file", :label => "Choose File to upload", :hint => "Max Size: 2MB" %>
        <% else %>
          <h3>Current Images: </h3>
          <h4><%= attachment.object.title %></h4>
          <%= link_to(image_tag(attachment.object.image.medium, :class => "show_item_img"), admin_attachment_path(attachment.object)) %>
          <p>
            <%= link_to "Edit", edit_admin_attachment_path(attachment.object) %> - 
            <%= link_to "Delete", admin_attachment_path(attachment.object), :method => 'delete', 
                  :confirm => "Are You sure you want to delete this Image?" 
            %>
          </p>
        <% end %>
      <% end %>
    </div>
  <% end %>
  
  
  <%= f.inputs :name => "Editor Notes" do %>
    <%= f.input :author_status, 
          :as => :select, 
          :label => "Author Status",
          :collection => ["Ready to go", "Needs Editing", "Needs Translation", "Needs Image"]
    %>
    <%= f.input :editor_notes, :as => "string" %>
    <%= f.input :updated_reason, :as => "string", :hint => "Provide a reason for editing, as short as possible, 2-4 words." %>
  <% end %>
  
  <%= f.input(:user_id, :label => false, :as => :hidden, :value => current_admin_user.id) if f.object.new_record? %>
  
  <%= f.buttons :commit %>
<% end %>



<script type="text/javascript">
  $(function() {
    $('#item_body').tinymce({
      theme : "advanced",
      height : "640px",
      plugins : "autolink,lists,spellchecker,pagebreak,style,layer,save,advhr,advimage,advlink,emotions,iespell,inlinepopups,insertdatetime,preview,media,searchreplace,print,paste,directionality,fullscreen,noneditable,visualchars,nonbreaking,xhtmlxtras,template",
      // Theme options
      theme_advanced_buttons1 : "save,newdocument,|,bold,italic,underline,strikethrough,|,justifyleft,justifycenter,justifyright,justifyfull,|,styleselect,formatselect,fontselect,fontsizeselect",
      theme_advanced_buttons2 : "cut,copy,paste,pastetext,pasteword,|,search,replace,|,bullist,numlist,|,outdent,indent,blockquote,|,undo,redo,|,link,unlink,anchor,image,cleanup,help,code,|,insertdate,inserttime,preview,|,forecolor,backcolor",
      theme_advanced_buttons3 : "hr,removeformat,visualaid,|,sub,sup,|,charmap,emotions,iespell,media,advhr,|,print,|,ltr,rtl,|,fullscreen",
      theme_advanced_buttons4 : "insertlayer,moveforward,movebackward,absolute,|,styleprops,spellchecker,|,cite,abbr,acronym,del,ins,attribs,|,visualchars,nonbreaking,template,blockquote,pagebreak,|,insertfile,insertimage",
      theme_advanced_toolbar_location : "top",
      theme_advanced_toolbar_align : "left",
      theme_advanced_statusbar_location : "bottom",
      theme_advanced_resizing : true,
      content_css : "<%= asset_path 'tinymce.css' %>",
      // Replace values for the template plugin
      template_replace_values : {
        username : "<%= current_admin_user.email %>",
        staffid : "<%= current_admin_user.id %>"
      }
    });
  });
  
  // 2012-01-24 23:03:22 +0700
  // item_published_at
  $("#item_published_at").AnyTime_picker(
      { 
        format: "%Y-%m-%d %H:%i:%s %+",
        formatUtcOffset: "%: (%@)",
        hideInput: false
      }
  );
  $("#item_expires_on").AnyTime_picker(
      { 
        format: "%Y-%m-%d %H:%i:%s %+",
        formatUtcOffset: "%: (%@)",
        hideInput: false
      }
  );

  $("#item_abstract").counter({
      count: 'up',
      goal: 120
  });
  $("#item_title").counter({
      count: 'up',
      goal: 100
  });
  
  $("#item_attachments_attributes_0_title").counter({
      count: 'up',
      goal: 80
  });
  
  // $(document).ready(function(){
  //   // get current number of characters
  //   $('#item_abstract_counter').html($('#item_abstract').val().length + ' chars');
  //   $('#item_abstract').keyup(function() {
  //     // get new length of characters
  //     $('#item_abstract_counter').html($(this).val().length + ' chars');
  //   });
  // });
  
</script>


