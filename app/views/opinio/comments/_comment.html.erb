<% reply = defined?(reply) ? reply : false %>
<li id="comment_<%= comment.id %>">
  <span class="comment_owner">
    <% if comment.owner %>
      <%= image_tag(comment.owner.main_image) %>
      <i><%= comment.owner.title %></i> said:
    <% end %>
  </span>
  <div class="comment_body">
    <%= sanitize comment.body,
          tags: comment.allowed_html_tags,
          attributes: comment.allowed_html_attributes
    %>
  </div>
  <span class="comment_date">
    <%= time_ago_in_words(comment.created_at) %> <%= _('Ago') %>
  </span>


  <%# this enables only 1 level of replies %>
  
  <div class="comment-actions">
    <% if Opinio.accept_replies && !reply %>
      <%= link_to _("Reply"),
          reply_comment_path(comment),
          remote: true,
          class: "btn small primary"
      %>
    <% end %>
    <% if current_admin_user && can?(:destroy, comment) %>
      <%= link_to _('Delete Comment'),
          comment_path(comment),
          method: :delete,
          remote: true,
          class: "btn btn-mini btn-danger",
          data: {
            disable_with: _('Deleting...'),
            confirm: _("Are you sure you want to delete this comment?")
          }
      %>
    <% end %>

    <% if can_edit_comment(comment) %>
      <%= link_to _('Edit Comment'),
          edit_comment_path(comment),
          class: "btn btn-mini btn-warning",
          data: {
            disable_with: 'Loading...'
          }
      %>
    <% end %>
  </div>
  
  <% if Opinio.accept_replies && !reply %>
    <ul id="comment_<%= comment.id %>_replies" class="replies">
      <%= render partial: "opinio/comments/comment",
            collection: comment.comments, locals: {reply: true}
      %>
    </ul>
  <% end %>
</li>
