/**
 * Controls: Link plugin
 *
 * Depends on jWYSIWYG
 *
 * By: Esteban Beltran (academo) <sergies@gmail.com>
 */
(function(e){"use strict";if(undefined===e.wysiwyg)throw"wysiwyg.link.js depends on $.wysiwyg";e.wysiwyg.controls||(e.wysiwyg.controls={}),e.wysiwyg.controls.link={init:function(t){var n=this,r,i,s,o,u,a,f,l,c,h,p,d;f={legend:"Insert Link",url:"Link URL",title:"Link Title",target:"Link Target",submit:"Insert Link",reset:"Cancel"},a='<form class="wysiwyg"><fieldset><legend>{legend}</legend><label>{url}: <input type="text" name="linkhref" value=""/></label><label>{title}: <input type="text" name="linktitle" value=""/></label><label>{target}: <input type="text" name="linktarget" value=""/></label><input type="submit" class="button" value="{submit}"/> <input type="reset" value="{reset}"/></fieldset></form>';for(l in f)e.wysiwyg.i18n&&(c=e.wysiwyg.i18n.t(f[l],"dialogs.link"),c===f[l]&&(c=e.wysiwyg.i18n.t(f[l],"dialogs")),f[l]=c),h=new RegExp("{"+l+"}","g"),a=a.replace(h,f[l]);o={self:t.dom.getElement("a"),href:"http://",title:"",target:""},o.self&&(o.href=o.self.href?o.self.href:o.href,o.title=o.self.title?o.self.title:"",o.target=o.self.target?o.self.target:"");if(e.fn.dialog){r=e(a),r.find("input[name=linkhref]").val(o.href),r.find("input[name=linktitle]").val(o.title),r.find("input[name=linktarget]").val(o.target);if(e.browser.msie)try{i=r.appendTo(t.editorDoc.body)}catch(v){i=r.appendTo("body")}else i=r.appendTo("body");i.dialog({modal:!0,open:function(n,r){e("input:submit",i).click(function(n){n.preventDefault();var r=e('input[name="linkhref"]',i).val(),s=e('input[name="linktitle"]',i).val(),a=e('input[name="linktarget"]',i).val(),f,l;t.options.controlLink.forceRelativeUrls&&(f=window.location.protocol+"//"+window.location.hostname,0===r.indexOf(f)&&(r=r.substr(f.length))),o.self?"string"==typeof r&&(r.length>0?e(o.self).attr("href",r).attr("title",s).attr("target",a):e(o.self).replaceWith(o.self.innerHTML)):(e.browser.msie&&t.ui.returnRange(),u=t.getRangeText(),l=t.dom.getElement("img"),u&&u.length>0||l?(e.browser.msie&&t.ui.focus(),"string"==typeof r&&(r.length>0?t.editorDoc.execCommand("createLink",!1,r):t.editorDoc.execCommand("unlink",!1,null)),o.self=t.dom.getElement("a"),e(o.self).attr("href",r).attr("title",s),e(o.self).attr("target",a)):t.options.messages.nonSelection&&window.alert(t.options.messages.nonSelection)),t.saveContent(),e(i).dialog("close")}),e("input:reset",i).click(function(t){t.preventDefault(),e(i).dialog("close")})},close:function(e,t){i.dialog("destroy"),i.remove()}})}else o.self?(s=window.prompt("URL",o.href),t.options.controlLink.forceRelativeUrls&&(p=window.location.protocol+"//"+window.location.hostname,0===s.indexOf(p)&&(s=s.substr(p.length))),"string"==typeof s&&(s.length>0?e(o.self).attr("href",s):e(o.self).replaceWith(o.self.innerHTML))):(u=t.getRangeText(),d=t.dom.getElement("img"),u&&u.length>0||d?e.browser.msie?(t.ui.focus(),t.editorDoc.execCommand("createLink",!0,null)):(s=window.prompt(f.url,o.href),t.options.controlLink.forceRelativeUrls&&(p=window.location.protocol+"//"+window.location.hostname,0===s.indexOf(p)&&(s=s.substr(p.length))),"string"==typeof s&&(s.length>0?t.editorDoc.execCommand("createLink",!1,s):t.editorDoc.execCommand("unlink",!1,null))):t.options.messages.nonSelection&&window.alert(t.options.messages.nonSelection)),t.saveContent();e(t.editorDoc).trigger("editorRefresh.wysiwyg")}},e.wysiwyg.createLink=function(t,n){return t.each(function(){var t=e(this).data("wysiwyg"),r;return t?!n||n.length===0?this:(r=t.getRangeText(),r&&r.length>0?(e.browser.msie&&t.ui.focus(),t.editorDoc.execCommand("unlink",!1,null),t.editorDoc.execCommand("createLink",!1,n)):t.options.messages.nonSelection&&window.alert(t.options.messages.nonSelection),this):this})}})(jQuery);