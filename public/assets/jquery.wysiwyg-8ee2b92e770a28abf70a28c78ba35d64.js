/**
 * WYSIWYG - jQuery plugin 0.97
 * (0.97.2 - From infinity)
 *
 * Copyright (c) 2008-2009 Juan M Martinez, 2010-2011 Akzhan Abdulin and all contributors
 * https://github.com/akzhan/jwysiwyg
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 *
 */
/*jslint browser: true, forin: true */
(function(e){"use strict";function r(){this.controls={bold:{groupIndex:0,visible:!0,tags:["b","strong"],css:{fontWeight:"bold"},tooltip:"Bold",hotkey:{ctrl:1,key:66}},copy:{groupIndex:8,visible:!1,tooltip:"Copy"},createLink:{groupIndex:6,visible:!0,exec:function(){var n=this;e.wysiwyg.controls&&e.wysiwyg.controls.link?e.wysiwyg.controls.link.init(this):e.wysiwyg.autoload?e.wysiwyg.autoload.control("wysiwyg.link.js",function(){n.controls.createLink.exec.apply(n)}):t.error("$.wysiwyg.controls.link not defined. You need to include wysiwyg.link.js file")},tags:["a"],tooltip:"Create link"},unLink:{groupIndex:6,visible:!0,exec:function(){this.editorDoc.execCommand("unlink",!1,null)},tooltip:"Remove link"},cut:{groupIndex:8,visible:!1,tooltip:"Cut"},decreaseFontSize:{groupIndex:9,visible:!1,tags:["small"],tooltip:"Decrease font size",exec:function(){this.decreaseFontSize()}},h1:{groupIndex:7,visible:!0,className:"h1",command:e.browser.msie||e.browser.safari?"FormatBlock":"heading",arguments:e.browser.msie||e.browser.safari?"<h1>":"h1",tags:["h1"],tooltip:"Header 1"},h2:{groupIndex:7,visible:!0,className:"h2",command:e.browser.msie||e.browser.safari?"FormatBlock":"heading",arguments:e.browser.msie||e.browser.safari?"<h2>":"h2",tags:["h2"],tooltip:"Header 2"},h3:{groupIndex:7,visible:!0,className:"h3",command:e.browser.msie||e.browser.safari?"FormatBlock":"heading",arguments:e.browser.msie||e.browser.safari?"<h3>":"h3",tags:["h3"],tooltip:"Header 3"},highlight:{tooltip:"Highlight",className:"highlight",groupIndex:1,visible:!1,css:{backgroundColor:"rgb(255, 255, 102)"},exec:function(){var t,n,r,i;e.browser.msie||e.browser.safari?t="backcolor":t="hilitecolor";if(e.browser.msie)n=this.getInternalRange().parentElement();else{r=this.getInternalSelection(),n=r.extentNode||r.focusNode;while(n.style===undefined){n=n.parentNode;if(n.tagName&&n.tagName.toLowerCase()==="body")return}}n.style.backgroundColor==="rgb(255, 255, 102)"||n.style.backgroundColor==="#ffff66"?i="#ffffff":i="#ffff66",this.editorDoc.execCommand(t,!1,i)}},html:{groupIndex:10,visible:!1,exec:function(){var t;this.options.resizeOptions&&e.fn.resizable&&(t=this.element.height()),this.viewHTML?(this.setContent(this.original.value),e(this.original).hide(),this.editor.show(),this.options.resizeOptions&&e.fn.resizable&&(t===this.element.height()&&this.element.height(t+this.editor.height()),this.element.resizable(e.extend(!0,{alsoResize:this.editor},this.options.resizeOptions))),this.ui.toolbar.find("li").each(function(){var t=e(this);t.hasClass("html")?t.removeClass("active"):t.removeClass("disabled")})):(this.saveContent(),e(this.original).css({width:this.element.outerWidth()-6,height:this.element.height()-this.ui.toolbar.height()-6,resize:"none"}).show(),this.editor.hide(),this.options.resizeOptions&&e.fn.resizable&&(t===this.element.height()&&this.element.height(this.ui.toolbar.height()),this.element.resizable("destroy")),this.ui.toolbar.find("li").each(function(){var t=e(this);t.hasClass("html")?t.addClass("active"):!1===t.hasClass("fullscreen")&&t.removeClass("active").addClass("disabled")})),this.viewHTML=!this.viewHTML},tooltip:"View source code"},increaseFontSize:{groupIndex:9,visible:!1,tags:["big"],tooltip:"Increase font size",exec:function(){this.increaseFontSize()}},indent:{groupIndex:2,visible:!0,tooltip:"Indent"},insertHorizontalRule:{groupIndex:6,visible:!0,tags:["hr"],tooltip:"Insert Horizontal Rule"},insertImage:{groupIndex:6,visible:!0,exec:function(){var n=this;e.wysiwyg.controls&&e.wysiwyg.controls.image?e.wysiwyg.controls.image.init(this):e.wysiwyg.autoload?e.wysiwyg.autoload.control("wysiwyg.image.js",function(){n.controls.insertImage.exec.apply(n)}):t.error("$.wysiwyg.controls.image not defined. You need to include wysiwyg.image.js file")},tags:["img"],tooltip:"Insert image"},insertOrderedList:{groupIndex:5,visible:!0,tags:["ol"],tooltip:"Insert Ordered List"},insertTable:{groupIndex:6,visible:!0,exec:function(){var n=this;e.wysiwyg.controls&&e.wysiwyg.controls.table?e.wysiwyg.controls.table(this):e.wysiwyg.autoload?e.wysiwyg.autoload.control("wysiwyg.table.js",function(){n.controls.insertTable.exec.apply(n)}):t.error("$.wysiwyg.controls.table not defined. You need to include wysiwyg.table.js file")},tags:["table"],tooltip:"Insert table"},insertUnorderedList:{groupIndex:5,visible:!0,tags:["ul"],tooltip:"Insert Unordered List"},italic:{groupIndex:0,visible:!0,tags:["i","em"],css:{fontStyle:"italic"},tooltip:"Italic",hotkey:{ctrl:1,key:73}},justifyCenter:{groupIndex:1,visible:!0,tags:["center"],css:{textAlign:"center"},tooltip:"Justify Center"},justifyFull:{groupIndex:1,visible:!0,css:{textAlign:"justify"},tooltip:"Justify Full"},justifyLeft:{visible:!0,groupIndex:1,css:{textAlign:"left"},tooltip:"Justify Left"},justifyRight:{groupIndex:1,visible:!0,css:{textAlign:"right"},tooltip:"Justify Right"},ltr:{groupIndex:10,visible:!1,exec:function(){var t=this.dom.getElement("p");return t?(e(t).attr("dir","ltr"),!0):!1},tooltip:"Left to Right"},outdent:{groupIndex:2,visible:!0,tooltip:"Outdent"},paragraph:{groupIndex:7,visible:!1,className:"paragraph",command:"FormatBlock",arguments:e.browser.msie||e.browser.safari?"<p>":"p",tags:["p"],tooltip:"Paragraph"},paste:{groupIndex:8,visible:!1,tooltip:"Paste"},redo:{groupIndex:4,visible:!0,tooltip:"Redo"},removeFormat:{groupIndex:10,visible:!0,exec:function(){this.removeFormat()},tooltip:"Remove formatting"},rtl:{groupIndex:10,visible:!1,exec:function(){var t=this.dom.getElement("p");return t?(e(t).attr("dir","rtl"),!0):!1},tooltip:"Right to Left"},strikeThrough:{groupIndex:0,visible:!0,tags:["s","strike"],css:{textDecoration:"line-through"},tooltip:"Strike-through"},subscript:{groupIndex:3,visible:!0,tags:["sub"],tooltip:"Subscript"},superscript:{groupIndex:3,visible:!0,tags:["sup"],tooltip:"Superscript"},underline:{groupIndex:0,visible:!0,tags:["u"],css:{textDecoration:"underline"},tooltip:"Underline",hotkey:{ctrl:1,key:85}},undo:{groupIndex:4,visible:!0,tooltip:"Undo"},code:{visible:!0,groupIndex:6,tooltip:"Code snippet",exec:function(){var t=this.getInternalRange(),n=e(t.commonAncestorContainer),r=t.commonAncestorContainer.nodeName.toLowerCase();n.parent("code").length?n.unwrap():r!=="body"&&n.wrap("<code/>")}},cssWrap:{visible:!1,groupIndex:6,tooltip:"CSS Wrapper",exec:function(){e.wysiwyg.controls.cssWrap.init(this)}}},this.defaults={html:'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" style="margin:0"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></head><body style="margin:0;">INITIAL_CONTENT</body></html>',debug:!1,controls:{},css:{},events:{},autoGrow:!1,autoSave:!0,brIE:!0,formHeight:270,formWidth:440,iFrameClass:null,initialContent:"<p>Initial content</p>",maxHeight:1e4,maxLength:0,messages:{nonSelection:"Select the text you wish to link"},toolbarHtml:'<ul role="menu" class="toolbar"></ul>',removeHeadings:!1,replaceDivWithP:!1,resizeOptions:!1,rmUnusedControls:!1,rmUnwantedBr:!0,tableFiller:"Lorem ipsum",initialMinHeight:null,controlImage:{forceRelativeUrls:!1},controlLink:{forceRelativeUrls:!1},plugins:{autoload:!1,i18n:!1,rmFormat:{rmMsWordMarkup:!1}},dialog:"default"},this.availableControlProperties=["arguments","callback","className","command","css","custom","exec","groupIndex","hotkey","icon","tags","tooltip","visible"],this.editor=null,this.editorDoc=null,this.element=null,this.options={},this.original=null,this.savedRange=null,this.timers=[],this.validKeyCodes=[8,9,13,16,17,18,19,20,27,33,34,35,36,37,38,39,40,45,46],this.isDestroyed=!1,this.dom={ie:{parent:null},w3c:{parent:null}},this.dom.parent=this,this.dom.ie.parent=this.dom,this.dom.w3c.parent=this.dom,this.ui={},this.ui.self=this,this.ui.toolbar=null,this.ui.initialHeight=null,this.dom.getAncestor=function(e,t){t=t.toLowerCase();while(e&&typeof e.tagName!="undefined"&&"body"!==e.tagName.toLowerCase()){if(t===e.tagName.toLowerCase())return e;e=e.parentNode}if(!e.tagName&&(e.previousSibling||e.nextSibling)){if(e.previousSibling&&e.previousSibling.tagName.toLowerCase()==t)return e.previousSibling;if(e.nextSibling&&e.nextSibling.tagName.toLowerCase()==t)return e.nextSibling}return null},this.dom.getElement=function(e){var t=this;return e=e.toLowerCase(),window.getSelection?t.w3c.getElement(e):t.ie.getElement(e)},this.dom.ie.getElement=function(e){var t=this.parent,n=t.parent.getInternalSelection(),r=n.createRange(),i;if("Control"===n.type){if(1!==r.length)return null;i=r.item(0)}else i=r.parentElement();return t.getAncestor(i,e)},this.dom.w3c.getElement=function(e){var t=this.parent,n=t.parent.getInternalRange(),r;if(!n)return null;r=n.commonAncestorContainer,3===r.nodeType&&(r=r.parentNode),r===n.startContainer&&(r=r.childNodes[n.startOffset]);if(!r.tagName&&(r.previousSibiling||r.nextSibling)){if(r.previousSibiling&&r.previousSibiling.tagName.toLowerCase()==e)return r.previousSibiling;if(r.nextSibling&&r.nextSibling.tagName.toLowerCase()==e)return r.nextSibling}return t.getAncestor(r,e)},this.ui.addHoverClass=function(){e(this).addClass("wysiwyg-button-hover")},this.ui.appendControls=function(){var t=this,n=this.self,r=n.parseControls(),i=!0,s=[],o={},u,a,f=function(e,n){n.groupIndex&&a!==n.groupIndex&&(a=n.groupIndex,i=!1);if(!n.visible)return;i||(t.appendItemSeparator(),i=!0),n.custom?t.appendItemCustom(e,n):t.appendItem(e,n)};e.each(r,function(e,t){var n="empty";undefined!==t.groupIndex&&(""===t.groupIndex?n="empty":n=t.groupIndex),undefined===o[n]&&(s.push(n),o[n]={}),o[n][e]=t}),s.sort(function(e,t){return"number"==typeof e&&typeof e==typeof t?e-t:(e=e.toString(),t=t.toString(),e>t?1:e===t?0:-1)}),0<s.length&&(a=s[0]);for(u=0;u<s.length;u+=1)e.each(o[s[u]],f)},this.ui.appendItem=function(t,n){var r=this.self,i=n.className||n.command||t||"empty",s=n.tooltip||n.command||t||"";return e('<li role="menuitem" unselectable="on">'+i+"</li>").addClass(i).attr("title",s).hover(this.addHoverClass,this.removeHoverClass).click(function(i){if(e(this).hasClass("disabled"))return!1;r.triggerControl.apply(r,[t,n]);var s=e(i.target);for(var o in r.controls)if(s.hasClass(o)){r.ui.toolbar.find("."+o).toggleClass("active"),r.editorDoc.rememberCommand=!0;break}return this.blur(),r.ui.returnRange(),r.ui.focus(),!0}).appendTo(r.ui.toolbar)},this.ui.appendItemCustom=function(t,n){var r=this.self,i=n.tooltip||n.command||t||"";return n.callback&&e(window).bind("trigger-"+t+".wysiwyg",n.callback),e('<li role="menuitem" unselectable="on" style="background: url(\''+n.icon+"') no-repeat;\"></li>").addClass("custom-command-"+t).addClass("wysiwyg-custom-command").addClass(t).attr("title",i).hover(this.addHoverClass,this.removeHoverClass).click(function(){return e(this).hasClass("disabled")?!1:(r.triggerControl.apply(r,[t,n]),this.blur(),r.ui.returnRange(),r.ui.focus(),r.triggerControlCallback(t),!0)}).appendTo(r.ui.toolbar)},this.ui.appendItemSeparator=function(){var t=this.self;return e('<li role="separator" class="separator"></li>').appendTo(t.ui.toolbar)},this.autoSaveFunction=function(){this.saveContent()},this.ui.checkTargets=function(t){var n=this.self;e.each(n.options.controls,function(r,i){var s=i.className||i.command||r||"empty",o,u,a,f,l=function(e,t){var r;"function"==typeof t?(r=t,r(f.css(e).toString().toLowerCase(),n)&&n.ui.toolbar.find("."+s).addClass("active")):f.css(e).toString().toLowerCase()===t&&n.ui.toolbar.find("."+s).addClass("active")};"fullscreen"!==s&&n.ui.toolbar.find("."+s).removeClass("active");if(i.tags||i.options&&i.options.tags){o=i.tags||i.options&&i.options.tags,u=t;while(u){if(u.nodeType!==1)break;e.inArray(u.tagName.toLowerCase(),o)!==-1&&n.ui.toolbar.find("."+s).addClass("active"),u=u.parentNode}}if(i.css||i.options&&i.options.css){a=i.css||i.options&&i.options.css,f=e(t);while(f){if(f[0].nodeType!==1)break;e.each(a,l),f=f.parent()}}})},this.ui.designMode=function(){var e=3,t=this.self,n;n=function(e){if("on"===t.editorDoc.designMode){t.timers.designMode&&window.clearTimeout(t.timers.designMode),t.innerDocument()!==t.editorDoc&&t.ui.initFrame();return}try{t.editorDoc.designMode="on"}catch(r){}e-=1,e>0&&(t.timers.designMode=window.setTimeout(function(){n(e)},100))},n(e)},this.destroy=function(){this.isDestroyed=!0;var t,n=this.element.closest("form");for(t=0;t<this.timers.length;t+=1)window.clearTimeout(this.timers[t]);return n.unbind(".wysiwyg"),this.element.remove(),e.removeData(this.original,"wysiwyg"),e(this.original).show(),this},this.getRangeText=function(){var e=this.getInternalRange();return e.toString?e=e.toString():e.text&&(e=e.text),e},this.execute=function(e,t){typeof t=="undefined"&&(t=null),this.editorDoc.execCommand(e,!1,t)},this.extendOptions=function(t){var n={};return"object"==typeof t.controls&&(n=t.controls,delete t.controls),t=e.extend(!0,{},this.defaults,t),t.controls=e.extend(!0,{},n,this.controls,n),t.rmUnusedControls&&e.each(t.controls,function(e){n[e]||delete t.controls[e]}),t},this.ui.focus=function(){var e=this.self;return e.editor.get(0).contentWindow.focus(),e},this.ui.returnRange=function(){var e=this.self,n;if(e.savedRange!==null){if(window.getSelection){n=window.getSelection(),n.rangeCount>0&&n.removeAllRanges();try{n.addRange(e.savedRange)}catch(r){t.error(r)}}else window.document.createRange?window.getSelection().addRange(e.savedRange):window.document.selection&&e.savedRange.select();e.savedRange=null}},this.increaseFontSize=function(){if(e.browser.mozilla||e.browser.opera)this.editorDoc.execCommand("increaseFontSize",!1,null);else if(e.browser.safari){var n=this.getInternalRange(),r=this.getInternalSelection(),i=this.editorDoc.createElement("big");if(!0===n.collapsed&&3===n.commonAncestorContainer.nodeType){var s=n.commonAncestorContainer.nodeValue.toString(),o=s.lastIndexOf(" ",n.startOffset)+1,u=-1===s.indexOf(" ",n.startOffset)?s:s.indexOf(" ",n.startOffset);n.setStart(n.commonAncestorContainer,o),n.setEnd(n.commonAncestorContainer,u),n.surroundContents(i),r.addRange(n)}else n.surroundContents(i),r.removeAllRanges(),r.addRange(n)}else t.error("Internet Explorer?")},this.decreaseFontSize=function(){if(e.browser.mozilla||e.browser.opera)this.editorDoc.execCommand("decreaseFontSize",!1,null);else if(e.browser.safari){var n=this.getInternalRange(),r=this.getInternalSelection(),i=this.editorDoc.createElement("small");if(!0===n.collapsed&&3===n.commonAncestorContainer.nodeType){var s=n.commonAncestorContainer.nodeValue.toString(),o=s.lastIndexOf(" ",n.startOffset)+1,u=-1===s.indexOf(" ",n.startOffset)?s:s.indexOf(" ",n.startOffset);n.setStart(n.commonAncestorContainer,o),n.setEnd(n.commonAncestorContainer,u),n.surroundContents(i),r.addRange(n)}else n.surroundContents(i),r.removeAllRanges(),r.addRange(n)}else t.error("Internet Explorer?")},this.getContent=function(){return this.viewHTML&&this.setContent(this.original.value),this.events.filter("getContent",this.editorDoc.body.innerHTML)},this.events={_events:{},bind:function(e,t){typeof this._events.eventName!="object"&&(this._events[e]=[]),this._events[e].push(t)},trigger:function(t,n){if(typeof this._events.eventName=="object"){var r=this.editor;e.each(this._events[t],function(e,t){typeof t=="function"&&t.apply(r,n)})}},filter:function(t,n){if(typeof this._events[t]=="object"){var r=this.editor,i=Array.prototype.slice.call(arguments,1);e.each(this._events[t],function(e,t){typeof t=="function"&&(n=t.apply(r,i))})}return n}},this.getElementByAttributeValue=function(t,n,r){var i,s,o=this.editorDoc.getElementsByTagName(t);for(i=0;i<o.length;i+=1){s=o[i].getAttribute(n),e.browser.msie&&(s=s.substr(s.length-r.length));if(s===r)return o[i]}return!1},this.getInternalRange=function(){var e=this.getInternalSelection();return e?e.rangeCount&&e.rangeCount>0?e.getRangeAt(0):e.createRange?e.createRange():null:null},this.getInternalSelection=function(){if(this.editor.get(0).contentWindow){if(this.editor.get(0).contentWindow.getSelection)return this.editor.get(0).contentWindow.getSelection();if(this.editor.get(0).contentWindow.selection)return this.editor.get(0).contentWindow.selection}return this.editorDoc.getSelection?this.editorDoc.getSelection():this.editorDoc.selection?this.editorDoc.selection:null},this.getRange=function(){var e=this.getSelection();if(!e)return null;if(e.rangeCount&&e.rangeCount>0)e.getRangeAt(0);else if(e.createRange)return e.createRange();return null},this.getSelection=function(){return window.getSelection?window.getSelection():window.document.selection},this.ui.grow=function(){var t=this.self,n=e(t.editorDoc.body),r=e.browser.msie?n[0].scrollHeight:n.height()+2+20,i=t.ui.initialHeight,s=Math.max(r,i);return s=Math.min(s,t.options.maxHeight),t.editor.attr("scrolling",s<t.options.maxHeight?"no":"auto"),n.css("overflow",s<t.options.maxHeight?"hidden":""),t.editor.get(0).height=s,t},this.init=function(t,n){var r=this,i=e(t).closest("form"),s=t.width||t.clientWidth||0,o=t.height||t.clientHeight||0;this.options=this.extendOptions(n),this.original=t,this.ui.toolbar=e(this.options.toolbarHtml),e.browser.msie&&parseInt(e.browser.version,10)<8&&(this.options.autoGrow=!1),s===0&&t.cols&&(s=t.cols*8+21),o===0&&t.rows&&(o=t.rows*16+16),this.editor=e(window.location.protocol==="https:"?'<iframe src="javascript:false;"></iframe>':"<iframe></iframe>").attr("frameborder","0"),this.options.iFrameClass?this.editor.addClass(this.options.iFrameClass):(this.editor.css({minHeight:(o-6).toString()+"px",width:s>50?(s-8).toString()+"px":""}),e.browser.msie&&parseInt(e.browser.version,10)<7&&this.editor.css("height",o.toString()+"px"));if(t.id){var u=t.id+"-wysiwyg-iframe";document.getElementById(u)||this.editor.attr("id",u)}this.editor.attr("tabindex",e(t).attr("tabindex")),this.element=e("<div/>").addClass("wysiwyg"),this.options.iFrameClass||this.element.css({width:s>0?s.toString()+"px":"100%"}),e(t).hide().before(this.element),this.viewHTML=!1,this.initialContent=e(t).val(),this.ui.initFrame(),this.options.resizeOptions&&e.fn.resizable&&this.element.resizable(e.extend(!0,{alsoResize:this.editor},this.options.resizeOptions)),this.options.autoSave&&i.bind("submit.wysiwyg",function(){r.autoSaveFunction()}),i.bind("reset.wysiwyg",function(){r.resetFunction()})},this.ui.initFrame=function(){var n=this.self,r,i,s;n.ui.appendControls(),n.element.append(n.ui.toolbar).append(e("<div><!-- --></div>").css({clear:"both"})).append(n.editor),n.editorDoc=n.innerDocument();if(n.isDestroyed)return null;n.ui.designMode(),n.editorDoc.open(),n.editorDoc.write(n.options.html.replace(/INITIAL_CONTENT/,function(){return n.wrapInitialContent()})),n.editorDoc.close(),e.wysiwyg.plugin.bind(n),e(n.editorDoc).trigger("initFrame.wysiwyg"),e(n.editorDoc).bind("click.wysiwyg",function(e){n.ui.checkTargets(e.target?e.target:e.srcElement)}),setInterval(function(){var r=null;try{var i=n.getInternalRange();i&&(r={range:i,parent:e.browser.msie?i.parentElement():i.endContainer.parentNode,width:(e.browser.msie?i.boundingWidth:i.startOffset-i.endOffset)||0})}catch(s){t.error(s)}r&&r.width==0&&!n.editorDoc.rememberCommand&&n.ui.checkTargets(r.parent)},400),e(n.original).focus(function(){if(e(this).filter(":visible").length===0)return;n.ui.focus()}),e(n.editorDoc).keydown(function(e){var t;if(e.keyCode===8){t=/^<([\w]+)[^>]*>(<br\/?>)?<\/\1>$/;if(t.test(n.getContent()))return e.stopPropagation(),!1}return n.editorDoc.rememberCommand=!1,!0}),e.browser.msie?n.options.brIE&&e(n.editorDoc).keydown(function(e){if(e.keyCode===13){var t=n.getRange();return t.pasteHTML("<br/>"),t.collapse(!1),t.select(),!1}return!0}):e(n.editorDoc).keydown(function(e){var t,r;if(e.ctrlKey||e.metaKey)for(t in n.options.controls){r=n.options.controls[t];if(r.hotkey&&r.hotkey.ctrl&&e.keyCode===r.hotkey.key)return n.triggerControl.apply(n,[t,r]),!1}return!0}),n.options.plugins.rmFormat.rmMsWordMarkup&&e(n.editorDoc).bind("keyup.wysiwyg",function(t){(t.ctrlKey||t.metaKey)&&86===t.keyCode&&e.wysiwyg.rmFormat&&("object"==typeof n.options.plugins.rmFormat.rmMsWordMarkup?e.wysiwyg.rmFormat.run(n,{rules:{msWordMarkup:n.options.plugins.rmFormat.rmMsWordMarkup}}):e.wysiwyg.rmFormat.run(n,{rules:{msWordMarkup:{enabled:!0}}}))}),n.options.autoSave&&e(n.editorDoc).keydown(function(){n.autoSaveFunction()}).keyup(function(){n.autoSaveFunction()}).mousedown(function(){n.autoSaveFunction()}).bind(e.support.noCloneEvent?"input.wysiwyg":"paste.wysiwyg",function(){n.autoSaveFunction()}),n.options.autoGrow&&(n.options.initialMinHeight!==null?n.ui.initialHeight=n.options.initialMinHeight:n.ui.initialHeight=e(n.editorDoc).height(),e(n.editorDoc.body).css("border","1px solid white"),i=function(){n.ui.grow()},e(n.editorDoc).keyup(i),e(n.editorDoc).bind("editorRefresh.wysiwyg",i),n.ui.grow()),n.options.css&&(String===n.options.css.constructor?e.browser.msie?(r=n.editorDoc.createStyleSheet(n.options.css),e(r).attr({media:"all"})):(r=e("<link/>").attr({href:n.options.css,media:"all",rel:"stylesheet",type:"text/css"}),e(n.editorDoc).find("head").append(r)):n.timers.initFrame_Css=window.setTimeout(function(){e(n.editorDoc.body).css(n.options.css)},0)),n.initialContent.length===0&&("function"==typeof n.options.initialContent?n.setContent(n.options.initialContent()):n.setContent(n.options.initialContent)),n.options.maxLength>0&&e(n.editorDoc).keydown(function(t){e(n.editorDoc).text().length>=n.options.maxLength&&e.inArray(t.which,n.validKeyCodes)===-1&&t.preventDefault()}),e.each(n.options.events,function(t,r){e(n.editorDoc).bind(t+".wysiwyg",function(e){r.apply(n.editorDoc,[e,n])})}),e.browser.msie?e(n.editorDoc).bind("beforedeactivate.wysiwyg",function(){n.savedRange=n.getInternalRange()}):e(n.editorDoc).bind("blur.wysiwyg",function(){n.savedRange=n.getInternalRange()}),e(n.editorDoc.body).addClass("wysiwyg"),n.options.events&&n.options.events.save&&(s=n.options.events.save,e(n.editorDoc).bind("keyup.wysiwyg",s),e(n.editorDoc).bind("change.wysiwyg",s),e.support.noCloneEvent?e(n.editorDoc).bind("input.wysiwyg",s):(e(n.editorDoc).bind("paste.wysiwyg",s),e(n.editorDoc).bind("cut.wysiwyg",s)));if(n.options.xhtml5&&n.options.unicode){var o={ne:8800,le:8804,para:182,xi:958,darr:8595,nu:957,oacute:243,Uacute:218,omega:969,prime:8242,pound:163,igrave:236,thorn:254,forall:8704,emsp:8195,lowast:8727,brvbar:166,alefsym:8501,nbsp:160,delta:948,clubs:9827,lArr:8656,Omega:937,Auml:196,cedil:184,and:8743,plusmn:177,ge:8805,raquo:187,uml:168,equiv:8801,laquo:171,rdquo:8221,Epsilon:917,divide:247,fnof:402,chi:967,Dagger:8225,iacute:237,rceil:8969,sigma:963,Oslash:216,acute:180,frac34:190,lrm:8206,upsih:978,Scaron:352,part:8706,exist:8707,nabla:8711,image:8465,prop:8733,zwj:8205,omicron:959,aacute:225,Yuml:376,Yacute:221,weierp:8472,rsquo:8217,otimes:8855,kappa:954,thetasym:977,harr:8596,Ouml:214,Iota:921,ograve:242,sdot:8901,copy:169,oplus:8853,acirc:226,sup:8835,zeta:950,Iacute:205,Oacute:211,crarr:8629,Nu:925,bdquo:8222,lsquo:8216,apos:39,Beta:914,eacute:233,egrave:232,lceil:8968,Kappa:922,piv:982,Ccedil:199,ldquo:8220,Xi:926,cent:162,uarr:8593,hellip:8230,Aacute:193,ensp:8194,sect:167,Ugrave:217,aelig:230,ordf:170,curren:164,sbquo:8218,macr:175,Phi:934,Eta:919,rho:961,Omicron:927,sup2:178,euro:8364,aring:229,Theta:920,mdash:8212,uuml:252,otilde:245,eta:951,uacute:250,rArr:8658,nsub:8836,agrave:224,notin:8713,ndash:8211,Psi:936,Ocirc:212,sube:8838,szlig:223,micro:181,not:172,sup1:185,middot:183,iota:953,ecirc:234,lsaquo:8249,thinsp:8201,sum:8721,ntilde:241,scaron:353,cap:8745,atilde:227,lang:10216,__replacement:65533,isin:8712,gamma:947,Euml:203,ang:8736,upsilon:965,Ntilde:209,hearts:9829,Alpha:913,Tau:932,spades:9824,dagger:8224,THORN:222,"int":8747,lambda:955,Eacute:201,Uuml:220,infin:8734,rlm:8207,Aring:197,ugrave:249,Egrave:200,Acirc:194,rsaquo:8250,ETH:208,oslash:248,alpha:945,Ograve:210,Prime:8243,mu:956,ni:8715,real:8476,bull:8226,beta:946,icirc:238,eth:240,prod:8719,larr:8592,ordm:186,perp:8869,Gamma:915,reg:174,ucirc:251,Pi:928,psi:968,tilde:732,asymp:8776,zwnj:8204,Agrave:192,deg:176,AElig:198,times:215,Delta:916,sim:8764,Otilde:213,Mu:924,uArr:8657,circ:710,theta:952,Rho:929,sup3:179,diams:9830,tau:964,Chi:935,frac14:188,oelig:339,shy:173,or:8744,dArr:8659,phi:966,iuml:239,Lambda:923,rfloor:8971,iexcl:161,cong:8773,ccedil:231,Icirc:206,frac12:189,loz:9674,rarr:8594,cup:8746,radic:8730,frasl:8260,euml:235,OElig:338,hArr:8660,Atilde:195,Upsilon:933,there4:8756,ouml:246,oline:8254,Ecirc:202,yacute:253,auml:228,permil:8240,sigmaf:962,iquest:191,empty:8709,pi:960,Ucirc:219,supe:8839,Igrave:204,yen:165,rang:10217,trade:8482,lfloor:8970,minus:8722,Zeta:918,sub:8834,epsilon:949,yuml:255,Sigma:931,Iuml:207,ocirc:244};n.events.bind("getContent",function(e){return e.replace(/&(?:amp;)?(?!amp|lt|gt|quot)([a-z][a-z0-9]*);/gi,function(e,t){o[t]||(t=t.toLowerCase(),o[t]||(t="__replacement"));var n=o[t];return String.fromCharCode(n)})})}e(n.original).trigger("ready.jwysiwyg",[n.editorDoc,n])},this.innerDocument=function(){var e=this.editor.get(0);if(e.nodeName.toLowerCase()==="iframe"){if(e.contentDocument)return e.contentDocument;if(e.contentWindow)return e.contentWindow.document;if(this.isDestroyed)return null;t.error("Unexpected error in innerDocument")}return e},this.insertHtml=function(t){var n,r;return!t||t.length===0?this:(e.browser.msie?(this.ui.focus(),this.editorDoc.execCommand("insertImage",!1,"#jwysiwyg#"),n=this.getElementByAttributeValue("img","src","#jwysiwyg#"),n&&e(n).replaceWith(t)):e.browser.mozilla?1===e(t).length?(r=this.getInternalRange(),r.deleteContents(),r.insertNode(e(t).get(0))):this.editorDoc.execCommand("insertHTML",!1,t):this.editorDoc.execCommand("insertHTML",!1,t)||(this.editor.focus(),this.editorDoc.execCommand("insertHTML",!1,t)),this.saveContent(),this)},this.parseControls=function(){var t=this;return e.each(this.options.controls,function(n,r){e.each(r,function(r){if(-1===e.inArray(r,t.availableControlProperties))throw n+'["'+r+'"]: property "'+r+'" not exists in Wysiwyg.availableControlProperties'})}),this.options.parseControls?this.options.parseControls.call(this):this.options.controls},this.removeFormat=function(){return e.browser.msie&&this.ui.focus(),this.options.removeHeadings&&this.editorDoc.execCommand("formatBlock",!1,"<p>"),this.editorDoc.execCommand("removeFormat",!1,null),this.editorDoc.execCommand("unlink",!1,null),e.wysiwyg.rmFormat&&e.wysiwyg.rmFormat.enabled&&("object"==typeof this.options.plugins.rmFormat.rmMsWordMarkup?e.wysiwyg.rmFormat.run(this,{rules:{msWordMarkup:this.options.plugins.rmFormat.rmMsWordMarkup}}):e.wysiwyg.rmFormat.run(this,{rules:{msWordMarkup:{enabled:!0}}})),this},this.ui.removeHoverClass=function(){e(this).removeClass("wysiwyg-button-hover")},this.resetFunction=function(){this.setContent(this.initialContent)},this.saveContent=function(){if(this.viewHTML)return;if(this.original){var t,n;t=this.getContent(),this.options.rmUnwantedBr&&(t=t.replace(/<br\/?>$/,"")),this.options.replaceDivWithP&&(n=e("<div/>").addClass("temp").append(t),n.children("div").each(function(){var t=e(this),n=t.find("p"),r;if(0===n.length){n=e("<p></p>");if(this.attributes.length>0)for(r=0;r<this.attributes.length;r+=1)n.attr(this.attributes[r].name,t.attr(this.attributes[r].name));n.append(t.html()),t.replaceWith(n)}}),t=n.html()),e(this.original).val(t),this.options.events&&this.options.events.save&&this.options.events.save.call(this)}return this},this.setContent=function(e){return this.editorDoc.body.innerHTML=e,this.saveContent(),this},this.triggerControl=function(e,n){var r=n.command||e,i=n.arguments||[];if(n.exec)n.exec.apply(this);else{this.ui.focus(),this.ui.withoutCss();try{this.editorDoc.execCommand(r,!1,i)}catch(s){t.error(s)}}this.options.autoSave&&this.autoSaveFunction()},this.triggerControlCallback=function(t){e(window).trigger("trigger-"+t+".wysiwyg",[this])},this.ui.withoutCss=function(){var t=this.self;if(e.browser.mozilla)try{t.editorDoc.execCommand("styleWithCSS",!1,!1)}catch(n){try{t.editorDoc.execCommand("useCSS",!1,!0)}catch(r){}}return t},this.wrapInitialContent=function(){var e=this.initialContent,t=e.match(/<\/?p>/gi);return t?e:"<p>"+e+"</p>"}}var t=window.console?window.console:{log:e.noop,error:function(t){e.error(t)}},n="prop"in e.fn&&"removeProp"in e.fn;e.wysiwyg={messages:{noObject:"Something goes wrong, check object"},addControl:function(t,n,r){return t.each(function(){var t=e(this).data("wysiwyg"),i={},s;if(!t)return this;i[n]=e.extend(!0,{visible:!0,custom:!0},r),e.extend(!0,t.options.controls,i),s=e(t.options.toolbarHtml),t.ui.toolbar.replaceWith(s),t.ui.toolbar=s,t.ui.appendControls()})},clear:function(t){return t.each(function(){var t=e(this).data("wysiwyg");if(!t)return this;t.setContent("")})},console:t,destroy:function(t){return t.each(function(){var t=e(this).data("wysiwyg");if(!t)return this;t.destroy()})},document:function(t){var n=t.data("wysiwyg");return n?e(n.editorDoc):undefined},getContent:function(e){var t=e.data("wysiwyg");return t?t.getContent():undefined},getSelection:function(e){var t=e.data("wysiwyg");return t?t.getRangeText():undefined},init:function(t,n){return t.each(function(){var t=e.extend(!0,{},n),i;if("textarea"!==this.nodeName.toLowerCase()||e(this).data("wysiwyg"))return;i=new r,i.init(this,t),e.data(this,"wysiwyg",i),e(i.editorDoc).trigger("afterInit.wysiwyg")})},insertHtml:function(t,n){return t.each(function(){var t=e(this).data("wysiwyg");if(!t)return this;t.insertHtml(n)})},plugin:{listeners:{},bind:function(t){var n=this;e.each(this.listeners,function(r,i){var s,o;for(s=0;s<i.length;s+=1)o=n.parseName(i[s]),e(t.editorDoc).bind(r+".wysiwyg",{plugin:o},function(n){e.wysiwyg[n.data.plugin.name][n.data.plugin.method].apply(e.wysiwyg[n.data.plugin.name],[t])})})},exists:function(t){var n;return"string"!=typeof t?!1:(n=this.parseName(t),!e.wysiwyg[n.name]||!e.wysiwyg[n.name][n.method]?!1:!0)},listen:function(t,n){var r;return r=this.parseName(n),!e.wysiwyg[r.name]||!e.wysiwyg[r.name][r.method]?!1:(this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(n),!0)},parseName:function(e){var t;return"string"!=typeof e?!1:(t=e.split("."),2>t.length?!1:{name:t[0],method:t[1]})},register:function(n){return n.name||t.error("Plugin name missing"),e.each(e.wysiwyg,function(e){e===n.name&&t.error("Plugin with name '"+n.name+"' was already registered")}),e.wysiwyg[n.name]=n,!0}},removeFormat:function(t){return t.each(function(){var t=e(this).data("wysiwyg");if(!t)return this;t.removeFormat()})},save:function(t){return t.each(function(){var t=e(this).data("wysiwyg");if(!t)return this;t.saveContent()})},selectAll:function(e){var t=e.data("wysiwyg"),n,r,i;if(!t)return this;n=t.editorDoc.body,window.getSelection?(i=t.getInternalSelection(),i.selectAllChildren(n)):(r=n.createTextRange(),r.moveToElementText(n),r.select())},setContent:function(t,n){return t.each(function(){var t=e(this).data("wysiwyg");if(!t)return this;t.setContent(n)})},triggerControl:function(n,r){return n.each(function(){var n=e(this).data("wysiwyg");if(!n)return this;n.controls[r]||t.error("Control '"+r+"' not exists"),n.triggerControl.apply(n,[r,n.controls[r]])})},support:{prop:n},utils:{extraSafeEntities:[["<",">","'",'"'," "],[32]],encodeEntities:function(t){var n=this,r,i=[];return this.extraSafeEntities[1].length===0&&e.each(this.extraSafeEntities[0],function(e,t){n.extraSafeEntities[1].push(t.charCodeAt(0))}),r=t.split(""),e.each(r,function(t){var s=r[t].charCodeAt(0);e.inArray(s,n.extraSafeEntities[1])&&(s<65||s>127||s>90&&s<97)?i.push("&#"+s+";"):i.push(r[t])}),i.join("")}}},e.wysiwyg.dialog=function(t,n){var r=t&&t.options&&t.options.dialog?t.options.dialog:n.theme?n.theme:"default",i=new e.wysiwyg.dialog.createDialog(r),s=this,o=e(s);return this.options={modal:!0,draggable:!0,title:"Title",content:"Content",width:"auto",height:"auto",zIndex:2e3,open:!1,close:!1},this.isOpen=!1,e.extend(this.options,n),this.object=i,this.open=function(){this.isOpen=!0,i.init.apply(s,[]);var e=i.show.apply(s,[]);o.trigger("afterOpen",[e])},this.show=function(){this.isOpen=!0,o.trigger("beforeShow");var e=i.show.apply(s,[]);o.trigger("afterShow")},this.hide=function(){this.isOpen=!1,o.trigger("beforeHide");var e=i.hide.apply(s,[]);o.trigger("afterHide",[e])},this.close=function(){this.isOpen=!1;var e=i.hide.apply(s,[]);o.trigger("beforeClose",[e]),i.destroy.apply(s,[]),o.trigger("afterClose",[e])},this.options.open&&o.bind("afterOpen",this.options.open),this.options.close&&o.bind("afterClose",this.options.close),this
},e.extend(!0,e.wysiwyg.dialog,{_themes:{},_theme:"",register:function(t,n){e.wysiwyg.dialog._themes[t]=n},deregister:function(t){delete e.wysiwyg.dialog._themes[t]},createDialog:function(t){return new e.wysiwyg.dialog._themes[t]},getDimensions:function(){var t=document.body.scrollWidth,n=document.body.scrollHeight;return e.browser.opera&&(n=Math.max(e(document).height(),e(window).height(),document.documentElement.clientHeight)),[t,n]}}),e(function(){jQuery.ui&&e.wysiwyg.dialog.register("jqueryui",function(){var t=this;this._$dialog=null,this.init=function(){var n=this,r=this.options.content;typeof r=="object"&&(typeof r.html=="function"?r=r.html():typeof r.toString=="function"&&(r=r.toString())),t._$dialog=e("<div></div>").attr("title",this.options.title).html(r);var i=this.options.height=="auto"?300:this.options.height,s=this.options.width=="auto"?450:this.options.width;return t._$dialog.dialog({modal:this.options.modal,draggable:this.options.draggable,height:i,width:s}),t._$dialog},this.show=function(){return t._$dialog.dialog("open"),t._$dialog},this.hide=function(){return t._$dialog.dialog("close"),t._$dialog},this.destroy=function(){return t._$dialog.dialog("destroy"),t._$dialog}}),e.wysiwyg.dialog.register("default",function(){var t=this;this._$dialog=null,this.init=function(){var n=this,r=this.options.content;typeof r=="object"&&(typeof r.html=="function"?r=r.html():typeof r.toString=="function"&&(r=r.toString())),t._$dialog=e('<div class="wysiwyg-dialog"></div>').css({"z-index":this.options.zIndex});var i=e('<div class="wysiwyg-dialog-topbar"><div class="wysiwyg-dialog-close-wrapper"></div><div class="wysiwyg-dialog-title">'+this.options.title+"</div></div>"),s=e('<a href="#" class="wysiwyg-dialog-close-button">X</a>');s.click(function(){n.close()}),i.find(".wysiwyg-dialog-close-wrapper").prepend(s);var o=e('<div class="wysiwyg-dialog-content">'+r+"</div>");t._$dialog.append(i).append(o);var u=this.options.height=="auto"?300:this.options.height,a=this.options.width=="auto"?450:this.options.width;return t._$dialog.hide().css({width:a,height:u,left:(e(window).width()-a)/2,top:(e(window).height()-u)/3}),e("body").append(t._$dialog),t._$dialog},this.show=function(){if(this.options.modal){var n=e.wysiwyg.dialog.getDimensions(),r=e('<div class="wysiwyg-dialog-modal-div"></div>').css({width:n[0],height:n[1]});t._$dialog.wrap(r)}if(this.options.draggable){var i=!1;t._$dialog.find("div.wysiwyg-dialog-topbar").bind("mousedown",function(t){t.preventDefault(),e(this).css({cursor:"move"});var n=e(this),r=e(this).parents(".wysiwyg-dialog"),s=t.pageX-parseInt(r.css("left"),10),o=t.pageY-parseInt(r.css("top"),10);i=!0,e(this).css({cursor:"move"}),e(document).bind("mousemove",function(e){e.preventDefault(),i&&r.css({top:e.pageY-o,left:e.pageX-s})}).bind("mouseup",function(t){t.preventDefault(),i=!1,n.css({cursor:"auto"}),e(document).unbind("mousemove").unbind("mouseup")})})}return t._$dialog.show(),t._$dialog},this.hide=function(){return t._$dialog.hide(),t._$dialog},this.destroy=function(){return this.options.modal&&t._$dialog.unwrap(),this.options.draggable&&t._$dialog.find("div.wysiwyg-dialog-topbar").unbind("mousedown"),t._$dialog.remove(),t._$dialog}})}),e.fn.wysiwyg=function(n){var r=arguments,i;if("undefined"!=typeof e.wysiwyg[n])return r=Array.prototype.concat.call([r[0]],[this],Array.prototype.slice.call(r,1)),e.wysiwyg[n].apply(e.wysiwyg,Array.prototype.slice.call(r,1));if("object"==typeof n||!n)return Array.prototype.unshift.call(r,this),e.wysiwyg.init.apply(e.wysiwyg,r);if(e.wysiwyg.plugin.exists(n))return i=e.wysiwyg.plugin.parseName(n),r=Array.prototype.concat.call([r[0]],[this],Array.prototype.slice.call(r,1)),e.wysiwyg[i.name][i.method].apply(e.wysiwyg[i.name],Array.prototype.slice.call(r,1));t.error("Method '"+n+"' does not exist on jQuery.wysiwyg.\nTry to include some extra controls or plugins")},e.fn.getWysiwyg=function(){return this.data("wysiwyg")}})(jQuery);